<div id="rating-section-{{ spot_id }}" class="spot-rating" hx-target="this">
    <div class="rating-summary" data-rating-count="{{ summary.ratings_count if summary and summary.ratings_count else 0 }}">
        {% if error %}
        <div class="rating-error">{{ error }}</div>
        {% elif message %}
        <div class="rating-message">{{ message }}</div>
        {% endif %}

        {% if error %}
        <!-- Error state, no ratings displayed -->
        {% elif summary.ratings_count %}
        <strong>{{ '{:.1f}'.format(summary.average_score or 0) }}</strong>/5
        <span>({{ summary.ratings_count }} rating{% if summary.ratings_count != 1 %}s{% endif %})</span>
        {% else %}
        <span>No ratings yet.</span>
        {% endif %}
    </div>

    {% if error %}
        <!-- Error state: no rating form available -->
    {% elif current_user %}
    <form
        class="rating-form"
        hx-post="/skate-spots/{{ spot_id }}/ratings"
        hx-target="#rating-section-{{ spot_id }}"
        hx-swap="outerHTML"
    >
        <label for="rating-score-{{ spot_id }}">Your rating</label>
        <select id="rating-score-{{ spot_id }}" name="score" required>
            {% set current_score = summary.user_rating.score if summary.user_rating else None %}
            {% for value in range(1, 6) %}
            <option value="{{ value }}" {% if current_score == value %}selected{% endif %}>{{ value }}</option>
            {% endfor %}
        </select>

        <div class="rating-form-actions">
            <button type="submit" class="btn btn-primary">Save rating</button>
            {% if summary.user_rating %}
            <button
                type="button"
                class="btn btn-secondary"
                hx-delete="/skate-spots/{{ spot_id }}/ratings"
                hx-target="#rating-section-{{ spot_id }}"
                hx-swap="outerHTML"
                hx-confirm="Remove your rating for this spot?"
            >Remove rating</button>
            {% endif %}
        </div>
    </form>
    {% else %}
    <p class="rating-login-prompt">
        <a href="/login">Log in</a> to rate this spot.
    </p>
    {% endif %}
</div>
