{% extends "base.html" %}

{% block content %}
<div class="spot-detail-container">
    <div class="spot-detail-header">
        <a href="/skate-spots" class="back-link">‚Üê Back to all spots</a>
    </div>

    <div class="spot-detail">
        <!-- Photo Gallery -->
        {% if spot.photos %}
        <div class="spot-detail-gallery">
            {% for photo in spot.photos %}
            <img src="{{ photo.url }}" alt="Photo of {{ spot.name }}" loading="lazy">
            {% endfor %}
        </div>
        {% else %}
        <div class="spot-detail-gallery-placeholder">
            <span class="placeholder-icon-large">üõπ</span>
            <p>No photos yet</p>
        </div>
        {% endif %}

        <!-- Main Info -->
        <div class="spot-detail-info">
            <div class="spot-detail-title-row">
                <h1>{{ spot.name }}</h1>
                <div class="spot-detail-favorite">
                    {% set is_favorite = spot.id in favorite_spot_ids %}
                    {% with spot_id=spot.id, is_favorite=is_favorite, current_user=current_user %}
                        {% include "partials/favorite_button.html" %}
                    {% endwith %}
                </div>
            </div>

            <div class="spot-detail-meta">
                <span class="badge badge-type">{{ spot.spot_type|format_spot_type }}</span>
                <span class="badge badge-difficulty {{ spot.difficulty }}">{{ spot.difficulty|format_difficulty }}</span>
                {% if spot.is_public %}
                    <span class="badge badge-access">‚úÖ Public</span>
                {% else %}
                    <span class="badge badge-access">üîí Private</span>
                {% endif %}
                {% if spot.requires_permission %}
                    <span class="badge badge-warning">‚ö†Ô∏è Permission required</span>
                {% endif %}
            </div>

            <div class="spot-detail-location">
                <h3>Location</h3>
                <p>üìç {{ spot.location.city }}, {{ spot.location.country }}</p>
                {% if spot.location.address %}
                <p class="spot-detail-address">{{ spot.location.address }}</p>
                {% endif %}
            </div>

            <div class="spot-detail-description">
                <h3>Description</h3>
                <p>{{ spot.description }}</p>
            </div>

            <!-- Action Buttons (if owner or admin) -->
            {% if current_user %}
            <div class="spot-detail-actions">
                {% if current_user.is_admin or is_owner %}
                <a href="/skate-spots/{{ spot.id }}/edit" class="btn btn-edit">Edit Spot</a>
                <button
                    hx-delete="/api/v1/skate-spots/{{ spot.id }}"
                    hx-confirm="Are you sure you want to delete this spot?"
                    hx-target="body"
                    hx-swap="beforeend"
                    class="btn btn-delete">
                    Delete Spot
                </button>
                {% endif %}
            </div>
            {% endif %}
        </div>

        <!-- Sessions Section -->
        <div class="spot-detail-section">
            <h2>Sessions</h2>
            <div
                class="spot-sessions-container"
                hx-get="/skate-spots/{{ spot.id }}/sessions-section"
                hx-trigger="load"
                hx-target="this"
                hx-swap="outerHTML"
            >
                <div class="section-loading">Loading sessions...</div>
            </div>
        </div>

        <!-- Ratings Section -->
        <div class="spot-detail-section">
            <h2>Ratings</h2>
            <div
                class="spot-rating-container"
                hx-get="/skate-spots/{{ spot.id }}/rating-section"
                hx-trigger="load"
                hx-target="this"
                hx-swap="outerHTML"
            >
                <div class="section-loading">Loading ratings...</div>
            </div>
        </div>

        <!-- Comments Section -->
        <div class="spot-detail-section">
            <h2>Comments</h2>
            <div
                class="spot-comments-container"
                hx-get="/skate-spots/{{ spot.id }}/comments-section"
                hx-trigger="load"
                hx-target="this"
                hx-swap="outerHTML"
            >
                <div class="section-loading">Loading comments...</div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
